Array.prototype.contains=function(a){if(Array.prototype.indexOf){return this.indexOf(a)!=-1}for(var b in this){if(this[b]==a){return true}}return false};Array.prototype.setLength=function(a,b){b=typeof b!="undefined"?b:null;for(var c=0;c<a;c++){this[c]=b}return this};Array.prototype.addDimension=function(a,b){b=typeof b!="undefined"?b:null;var c=this.length;for(var d=0;d<c;d++){this[d]=[].setLength(a,b)}return this};Array.prototype.first=function(){return this[0]};Array.prototype.last=function(){return this[this.length-1]};Array.prototype.copy=function(){var a=[];var b=this.length;for(var c=0;c<b;c++){if(this[c]instanceof Array){a[c]=this[c].copy()}else{a[c]=this[c]}}return a};if(!Array.prototype.map){Array.prototype.map=function(a){var b=this.length;if(typeof a!="function"){throw new TypeError}var c=new Array(b);var d=arguments[1];for(var e=0;e<b;e++){if(e in this){c[e]=a.call(d,this[e],e,this)}}return c}}if(!Array.prototype.filter){Array.prototype.filter=function(a){var b=this.length;if(typeof a!="function"){throw new TypeError}var c=new Array;var d=arguments[1];for(var e=0;e<b;e++){if(e in this){var f=this[e];if(a.call(d,f,e,this)){c.push(f)}}}return c}}if(!Array.prototype.forEach){Array.prototype.forEach=function(a){var b=this.length;if(typeof a!="function"){throw new TypeError}var c=arguments[1];for(var d=0;d<b;d++){if(d in this){a.call(c,this[d],d,this)}}}}if(!Array.prototype.every){Array.prototype.every=function(a){var b=this.length;if(typeof a!="function"){throw new TypeError}var c=arguments[1];for(var d=0;d<b;d++){if(d in this&&!a.call(c,this[d],d,this)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(a){var b=this.length;if(typeof a!="function"){throw new TypeError}var c=arguments[1];for(var d=0;d<b;d++){if(d in this&&a.call(c,this[d],d,this)){return true}}return false}}Array.from=function(a){var b=[];for(var c=0;c<a.length;c++){b[c]=a[c]}return b};Function.prototype.bind=function(a){var b=this;var c=Array.from(arguments).slice(1);return function(){return b.apply(a,c.concat(Array.from(arguments)))}};kingo=window.kingo||{};(function(){var a=navigator.userAgent.toLowerCase();var b=(a.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1];kingo.browser={ua:a,ver:b,ie:/msie/.test(a)&&!/opera/.test(a),moz:/mozilla/.test(a)&&!/(compatible|webkit)/.test(a),safari3:/webkit/.test(a)&&parseInt(b,10)>=420};kingo.util={byId:function(a){return document.getElementById(a)},makeQueryString:function(a){var b="";if(a&&typeof a=="object"){var c=[];for(var d in a){if(a[d]&&a[d].constructor==Array){for(var e=0;e<a[d].length;e++){c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]))}}else{c.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]))}}b=c.join("&").replace(/%20/g,"+")}return b},ajax:function(a,b,c,d,e,f,g){function m(a){if(!j&&h&&(h.readyState==4||a=="timeout")){j=true;if(n){clearInterval(n);n=null}var b=a=="timeout"&&"timeout"||!l(h)&&"error"||"success";if(b=="success"){d.call(f,h)}else{e.call(f)}h=null}}function l(a){try{return!a.status&&location.protocol=="file:"||a.status>=200&&a.status<300||a.status==304||k&&a.status==undefined}catch(b){}return false}a=a.toUpperCase();var h=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var i=c&&typeof c=="object"?kingo.util.makeQueryString(c):null;if(i&&a=="GET"){b+=(b.match(/\?/)?"&":"?")+i;i=null}h.open(a,b,true);if(i){h.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}var j=false;var k=/webkit/.test(navigator.userAgent.toLowerCase());var n=setInterval(m,13);if(g){setTimeout(function(){if(h){h.abort();if(!j){m("timeout")}}},g)}h.send(i);return h},addEventHelper:function(a,b,c){if(a.addEventListener){a.addEventListener(b,c,false)}else{if(!kingo.util.addEventId){kingo.util.addEventId=1}if(!c.$$guid){c.$$guid=kingo.util.addEventId++}if(!a.events){a.events={}}var d=a.events[b];if(!d){d=a.events[b]={};if(a["on"+b]){d[0]=a["on"+b]}}d[c.$$guid]=c;a["on"+b]=kingo.util.handleEvent}},handleEvent:function(a){var b=true;a=a||((this.ownerDocument||this.document||this).parentWindow||window).event;var c=this.events[a.type];for(var d in c){this.$$handleEvent=c[d];if(this.$$handleEvent(a)===false){b=false}}return b},addEvent:function(a,b,c,d,e){if(!a){return}if(e){c=c.bind(d)}else{if(d){var f=c;c=function(a){f(a,d)}}}kingo.util.addEventHelper(a,b,c)},onClick:function(a,b,c){kingo.util.addEvent(a,"click",b,c,true)},getElClickXY:function(a,b,c){var d=b.ownerDocument;if(!a.pageX){a.pageX=a.clientX+(d.documentElement.scrollLeft||d.body.scrollLeft);a.pageY=a.clientY+(d.documentElement.scrollTop||d.body.scrollTop)}var e=kingo.util.getElXY(b,c);return[a.pageX-e[0],a.pageY-e[1]]},stopEvent:function(a){if(!a){return}if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}},getTarget:function(a){var b=a.target||a.srcElement;return b&&b.nodeName&&b.nodeName.toUpperCase()=="#TEXT"?b.parentNode:b},addClass:function(a,b){if(!b){return}var c=b.split(/\s+/);for(var d=0;d<c.length;d++){if(!kingo.util.hasClass(a,c[d])){a.className+=(a.className?" ":"")+c[d]}}},removeClass:function(a,b){var c=a.className.split(/\s+/);var d=[];for(var e=0;e<c.length;e++){if(c[e]!=b){d.push(c[e])}}a.className=d.join(" ")},hasClass:function(a,b){var c=a.className.split(/\s+/);for(var d=0;d<c.length;d++){if(c[d]==b){return true}}return false},show:function(a,b){b=b||"block";if(typeof a=="string"){a=kingo.util.byId(a)}if(!a){return}a.style.display=b},hide:function(a){if(typeof a=="string"){a=kingo.util.byId(a)}if(!a){return}a.style.display="none"},getElXY:function(a,b){var c=a,d=0,e=0,f=a.parentNode,g=0,h=0,i=a.ownerDocument;if(a.getBoundingClientRect){var j=a.getBoundingClientRect();d=j.left+Math.max(i.documentElement.scrollLeft,i.body.scrollLeft);e=j.top+Math.max(i.documentElement.scrollTop,i.body.scrollTop)}else{while(c){d+=c.offsetLeft;e+=c.offsetTop;c=c.offsetParent?c.offsetParent:null}while(!b&&f&&f.tagName&&!/^body|html$/i.test(f.tagName)){g+=f.scrollLeft;h+=f.scrollTop;d-=f.scrollLeft;e-=f.scrollTop;f=f.parentNode}}return[d,e,g,h]},getElX:function(a){return this.getElXY(a)[0]},getElY:function(a){return this.getElXY(a)[1]},addStyleSheet:function(a){if(document.createStyleSheet){document.createStyleSheet(a)}else{var b=document.createElement("link");b.rel="stylesheet";b.type="text/css";b.href=a;document.getElementsByTagName("head")[0].appendChild(b)}},getPlayerPath:function(){var a=document.getElementsByTagName("script");var b;var c;for(var d=0;c=a[d];d++){if(/(all\.compressed\.js|kingo\.js)/.test(c.src)){b=c.src.replace(/\/js\/[^\/]+$/,"")}}return b},numProperties:function(a){var b=0;for(var c in a){b++}return b}}})();kingo=window.kingo||{};kingo.i18n=kingo.i18n||{move:"Move",loading:"Loading",passed:"passed",resigned:"resigned",variations:"Variations","no variations":"none",tool:"Tool",view:"Jump to Move",play:"Play",region:"Select Region",add_b:"Black Stone",add_w:"White Stone","edit comment":"Edit Comment","edit game info":"Edit Game Info",done:"Done",triangle:"Triangle",square:"Square",circle:"Circle",x:"X",letter:"Letter",number:"Number",label:"Custom Label",dim:"Dim",clear:"Clear Marker",score:"Score","score est":"Score Estimate",search:"Search","search corner":"Corner Search","search center":"Center Search","region info":"Click and drag to select a region.","two stones":"Please select at least two stones to search for.","two edges":"For corner searches, your selection must touch two adjacent edges of the board.","no search url":"No search URL provided.","close search":"close search","matches found":"matches found.","show games":"Show pro games with this position","save to server":"Save to Server","download sgf":"Download SGF","multi-game sgf":"Multi-game SGF: ","next game":"Next Game","previous game":"Previous Game","end of variation":"End of variation",white:"White","white rank":"White rank","white team":"White team",black:"Black","black rank":"Black rank","black team":"Black team",captures:"captures","time left":"time left",you:"You",game:"Game",handicap:"Handicap",komi:"Komi",result:"Result",date:"Date",info:"Info",place:"Place",event:"Event",round:"Round",overtime:"Overtime",opening:"Openning",ruleset:"Ruleset",annotator:"Annotator",copyright:"Copyright",source:"Source","time limit":"Time limit",transcriber:"Transcriber","created with":"Created with",january:"January",february:"February",march:"March",april:"April",may:"May",june:"June",july:"July",august:"August",september:"September",october:"October",november:"November",december:"December",gw:"Good for White",vgw:"Very good for White",gb:"Good for Black",vgb:"Very good for Black",dm:"Even position",dmj:"Even position (joseki)",uc:"Unclear position",te:"Tesuji",bm:"Bad move",vbm:"Very bad move","do":"Doubtful move",it:"Interesting move","black to play":"Black to play","white to play":"White to play",ho:"Hotspot","confirm delete":"You've removed all properties from this position.\n\nDelete this position and all sub-positions?","position deleted":"Position deleted","dom error":"Error finding DOM container","error retrieving":"There was a problem retrieving the game data.","invalid data":"Received invalid game data","error board":"Error loading board container","unsaved changes":"There are unsaved changes in this game. You must save before you can permalink or download.","bad path":"Don't know how to get to path: ","gnugo thinking":"GNU Go is thinking..."};kingo.gameNodeIdCounter=1e5;kingo.GameNode=function(){this.init.apply(this,arguments)};kingo.GameNode.prototype={init:function(a,b,c){this._id=typeof c!="undefined"?c:kingo.gameNodeIdCounter++;this._parent=a||null;this._children=[];this._preferredChild=0;if(b){this.loadJson(b)}},pushProperty:function(a,b){if(this[a]){if(!(this[a]instanceof Array)){this[a]=[this[a]]}if(!this[a].contains(b)){this[a].push(b)}}else{this[a]=b}},hasPropertyValue:function(a,b){if(!this[a]){return false}var c=this[a]instanceof Array?this[a]:[this[a]];return c.contains(b)},deletePropertyValue:function(a,b){var c=b instanceof RegExp?function(a){return b.test(a)}:function(a){return b==a};var d=a instanceof Array?a:[a];for(var e=0;a=d[e];e++){if(this[a]instanceof Array){this[a]=this[a].filter(function(a){return!c(a)});if(!this[a].length){delete this[a]}}else{if(c(this.prop)){delete this[a]}}}},loadJson:function(a){var b=[a],c=[this];var d,e;var f,g;while(b.length){d=b.pop();e=c.pop();e.loadJsonNode(d);g=d._children?d._children.length:0;for(f=0;f<g;f++){b.push(d._children[f]);if(!e._children[f]){e._children[f]=new kingo.GameNode(e)}c.push(e._children[f])}}},loadJsonNode:function(a){for(var b in a){if(b=="_id"){this[b]=a[b].toString();kingo.gameNodeIdCounter=Math.max(kingo.gameNodeIdCounter,parseInt(a[b],10));continue}if(b.charAt(0)!="_"){this[b]=a[b]}}},appendChild:function(a){a._parent=this;this._children.push(a)},getProperties:function(){var a={},b,c,d,e;for(b in this){isPrivate=b.charAt(0)=="_";d=typeof this[b]=="string";e=this[b]instanceof Array;if(!isPrivate&&(d||e)){a[b]=this[b]}}return a},walk:function(a,b){var c=[this];var d;var e,f;while(c.length){d=c.pop();a.call(b||this,d);f=d._children?d._children.length:0;for(e=0;e<f;e++){c.push(d._children[e])}}},getMove:function(){if(typeof this.W!="undefined"){return this.W}else{if(typeof this.B!="undefined"){return this.B}}return null},emptyPoint:function(a){var b=this.getProperties();var c=null;for(var d in b){if(d=="AW"||d=="AB"||d=="AE"){if(!(this[d]instanceof Array)){this[d]=[this[d]]}this[d]=this[d].filter(function(b){if(b==a){c=b;return false}return true});if(!this[d].length){delete this[d]}}else{if((d=="B"||d=="W")&&this[d]==a){c=this[d];delete this[d]}}}return c},getPosition:function(){if(!this._parent){return null}var a=this._parent._children;for(var b=0;b<a.length;b++){if(a[b]._id==this._id){return b}}return null},toSgf:function(){function c(a){if(!a){return""}var b=";",c,d;for(c in a){if(a[c]instanceof Array){d=a[c].map(function(a){return a.toString().replace(/\]/g,"\\]")}).join("][")}else{d=a[c].toString().replace(/\]/g,"\\]")}b+=c+"["+d+"]"}return b}var a=this._parent?"(":"";var b=this;a+=c(b.getProperties());while(b._children.length==1){b=b._children[0];a+=c(b.getProperties())}for(var d=0;d<b._children.length;d++){a+=b._children[d].toSgf()}a+=this._parent?")":"";return a}};kingo.GameCursor=function(){this.init.apply(this,arguments)};kingo.GameCursor.prototype={init:function(a){this.node=a},next:function(a){if(!this.hasNext()){return false}a=typeof a=="undefined"||a==null?this.node._preferredChild:a;this.node._preferredChild=a;this.node=this.node._children[a];return true},previous:function(){if(!this.hasPrevious()){return false}this.node=this.node._parent;return true},hasNext:function(){return this.node&&this.node._children.length},hasPrevious:function(){return this.node&&this.node._parent&&this.node._parent._parent},getNextMoves:function(){if(!this.hasNext()){return null}var a={};var b,c;for(b=0;c=this.node._children[b];b++){a[c.getMove()]=b}return a},getNextColor:function(){if(!this.hasNext()){return null}var a,b;for(var a=0;b=this.node._children[a];a++){if(b.W||b.B){return b.W?"W":"B"}}return null},getNextNodeWithVariations:function(){var a=this.node;while(a._children.length==1){a=a._children[0]}return a},getPath:function(){var a=this.node,b=[],c=0;while(a&&a._parent&&a._parent._children.length==1&&a._parent._parent){c++;a=a._parent}b.push(c);while(a){if(a._parent&&(a._parent._children.length>1||!a._parent._parent)){b.push(a.getPosition()||0)}a=a._parent}return b.reverse()},getPathMoves:function(){var a=[];var b=new kingo.GameCursor(this.node);a.push(b.node.getMove());while(b.previous()){var c=b.node.getMove();if(c){a.push(c)}}return a.reverse()},getMoveNumber:function(){var a=0,b=this.node;while(b){if(b.W||b.B){a++}b=b._parent}return a},getGameRoot:function(){if(!this.node){return null}var a=new kingo.GameCursor(this.node);if(!this.node._parent&&this.node._children.length){return this.node._children[0]}while(a.previous()){}return a.node}};kingo.SgfParser=function(){this.init.apply(this,arguments)};kingo.SgfParser.prototype={init:function(a,b){b=typeof b=="function"?b:null;this.sgf=a;this.index=0;this.root={_children:[]};this.parseTree(this.root);b&&b.call(this)},parseTree:function(a){while(this.index<this.sgf.length){var b=this.curChar();this.index++;switch(b){case";":a=this.parseNode(a);break;case"(":this.parseTree(a);break;case")":return;break}}},parseNode:function(a){var b={_children:[]};if(a){a._children.push(b)}else{this.root=b}b=this.parseProperties(b);return b},parseProperties:function(a){var b="";var c=[];var d=0;while(this.index<this.sgf.length){var e=this.curChar();if(e==";"||e=="("||e==")"){break}if(this.curChar()=="["){while(this.curChar()=="["){this.index++;c[d]="";while(this.curChar()!="]"&&this.index<this.sgf.length){if(this.curChar()=="\\"){this.index++;while(this.curChar()=="\r"||this.curChar()=="\n"){this.index++}}c[d]+=this.curChar();this.index++}d++;while(this.curChar()=="]"||this.curChar()=="\n"||this.curChar()=="\r"){this.index++}}if(a[b]){if(!(a[b]instanceof Array)){a[b]=[a[b]]}a[b]=a[b].concat(c)}else{a[b]=c.length>1?c:c[0]}b="";c=[];d=0;continue}if(e!=" "&&e!="\n"&&e!="\r"&&e!="\t"){b+=e}this.index++}return a},curChar:function(){return this.sgf.charAt(this.index)}};kingo.Board=function(){this.init.apply(this,arguments)};kingo.Board.prototype={WHITE:1,BLACK:-1,EMPTY:0,init:function(a,b){this.boardSize=b||19;this.stones=this.makeBoardArray(this.EMPTY);this.markers=this.makeBoardArray(this.EMPTY);this.captures={};this.captures.W=0;this.captures.B=0;this.cache=[];this.renderer=a||new kingo.BoardRendererHtml;this.lastRender={stones:this.makeBoardArray(null),markers:this.makeBoardArray(null)}},reset:function(){this.init(this.renderer,this.boardSize)},clear:function(){this.clearStones();this.clearMarkers();this.clearCaptures()},clearStones:function(){for(var a=0;a<this.stones.length;a++){this.stones[a]=this.EMPTY}},clearMarkers:function(){for(var a=0;a<this.markers.length;a++){this.markers[a]=this.EMPTY}},clearCaptures:function(){this.captures.W=0;this.captures.B=0},makeBoardArray:function(a){return[].setLength(this.boardSize*this.boardSize,a)},commit:function(){this.cache.push({stones:this.stones.concat(),captures:{W:this.captures.W,B:this.captures.B}})},rollback:function(){if(this.cache.last()){this.stones=this.cache.last().stones.concat();this.captures.W=this.cache.last().captures.W;this.captures.B=this.cache.last().captures.B}else{this.clear()}},revert:function(a){a=a||1;this.rollback();for(var b=0;b<a;b++){this.cache.pop()}this.rollback()},addStone:function(a,b){this.stones[a.y*this.boardSize+a.x]=b},getStone:function(a){return this.stones[a.y*this.boardSize+a.x]},getRegion:function(a,b,c,d){var e=[].setLength(c*d,this.EMPTY);var f;for(var g=a;g<a+d;g++){for(var h=b;h<b+c;h++){f=(g-a)*c+(h-b);e[f]=this.getStone({x:h,y:g})}}return e},addMarker:function(a,b){this.markers[a.y*this.boardSize+a.x]=b},getMarker:function(a){return this.markers[a.y*this.boardSize+a.x]},render:function(a){var b=this.makeBoardArray(null);var c=this.makeBoardArray(null);var d,e;var f;if(!a&&this.cache.last()){var g=this.cache.last();f=this.stones.length;for(var h=0;h<f;h++){if(g.stones[h]!=this.lastRender.stones[h]){b[h]=g.stones[h]}}c=this.markers}else{b=this.stones;c=this.markers}var i;for(var j=0;j<this.boardSize;j++){for(var k=0;k<this.boardSize;k++){i=k*this.boardSize+j;if(c[i]!=null){this.renderer.renderMarker({x:j,y:k},c[i]);this.lastRender.markers[i]=c[i]}if(b[i]==null){continue}else{if(b[i]==this.EMPTY){d="empty"}else{d=b[i]==this.WHITE?"white":"black"}}this.renderer.renderStone({x:j,y:k},d);this.lastRender.stones[i]=b[i]}}}};kingo.BoardRendererHtml=function(){this.init.apply(this,arguments)};kingo.BoardRendererHtml.prototype={init:function(a,b,c,d){if(!a){throw"No DOM container";return}this.boardSize=b||19;var e=document.createElement("div");e.className="board-gutter"+(this.boardSize==19?" with-coords":"");a.appendChild(e);var f=document.createElement("div");f.className="board size"+this.boardSize;f.style.position=d&&kingo.browser.ie?"static":"relative";e.appendChild(f);this.domNode=f;this.domGutter=e;this.domContainer=a;this.player=c;this.uniq=a.id+"-";this.renderCache={stones:[].setLength(this.boardSize,0).addDimension(this.boardSize,0),markers:[].setLength(this.boardSize,0).addDimension(this.boardSize,0)};this.pointWidth=0;this.pointHeight=0;this.margin=0;var g=this.renderStone({x:0,y:0},"black");this.pointWidth=this.pointHeight=g.offsetWidth;this.renderStone({x:0,y:0},"white");this.renderMarker({x:0,y:0},"current");this.clear();this.margin=(this.domNode.offsetWidth-this.boardSize*this.pointWidth)/2-5;this.scrollX=0;this.scrollY=0;if(d){this.crop(d);if(kingo.browser.ie){var h=this.domNode.parentNode;while(h&&h.tagName&&!/^body|html$/i.test(h.tagName)){this.scrollX+=h.scrollLeft;this.scrollY+=h.scrollTop;h=h.parentNode}}}this.dom={};this.dom.searchRegion=document.createElement("div");this.dom.searchRegion.id=this.uniq+"search-region";this.dom.searchRegion.className="search-region";this.domNode.appendChild(this.dom.searchRegion);kingo.util.addEvent(this.domNode,"mousemove",this.handleHover,this,true);kingo.util.addEvent(this.domNode,"mousedown",this.handleMouseDown,this,true);kingo.util.addEvent(this.domNode,"mouseup",this.handleMouseUp,this,true)},showRegion:function(a){this.dom.searchRegion.style.top=this.margin+this.pointHeight*a[0]+"px";this.dom.searchRegion.style.left=this.margin+this.pointWidth*a[1]+"px";this.dom.searchRegion.style.width=this.pointWidth*a[2]+"px";this.dom.searchRegion.style.height=this.pointHeight*a[3]+"px";kingo.util.show(this.dom.searchRegion)},hideRegion:function(){kingo.util.hide(this.dom.searchRegion)},clear:function(){this.domNode.innerHTML=""},renderStone:function(a,b){var c=document.getElementById(this.uniq+"stone-"+a.x+"-"+a.y);if(c){c.parentNode.removeChild(c)}if(b!="empty"){var d=document.createElement("div");d.id=this.uniq+"stone-"+a.x+"-"+a.y;d.className="point stone "+b;try{d.style.left=a.x*this.pointWidth+this.margin-this.scrollX+"px";d.style.top=a.y*this.pointHeight+this.margin-this.scrollY+"px"}catch(e){}this.domNode.appendChild(d);return d}return null},renderMarker:function(a,b){if(this.renderCache.markers[a.x][a.y]){var c=document.getElementById(this.uniq+"marker-"+a.x+"-"+a.y);if(c){c.parentNode.removeChild(c)}}if(b=="empty"||!b){this.renderCache.markers[a.x][a.y]=0;return null}this.renderCache.markers[a.x][a.y]=1;if(b){var d="";switch(b){case"triangle":case"square":case"circle":case"ex":case"territory-white":case"territory-black":case"dim":case"current":break;default:if(b.indexOf("var:")==0){d=b.substring(4);b="variation"}else{d=b;b="label"}break}var e=document.createElement("div");e.id=this.uniq+"marker-"+a.x+"-"+a.y;e.className="point marker "+b;try{e.style.left=a.x*this.pointWidth+this.margin-this.scrollX+"px";e.style.top=a.y*this.pointHeight+this.margin-this.scrollY+"px"}catch(f){}e.appendChild(document.createTextNode(d));this.domNode.appendChild(e);return e}return null},setCursor:function(a){this.domNode.style.cursor=a},handleHover:function(a){var b=this.getXY(a);this.player.handleBoardHover(b[0],b[1],b[2],b[3],a)},handleMouseDown:function(a){var b=this.getXY(a);this.player.handleBoardMouseDown(b[0],b[1],b[2],b[3],a)},handleMouseUp:function(a){var b=this.getXY(a);this.player.handleBoardMouseUp(b[0],b[1])},getXY:function(a){var b=kingo.util.getElClickXY(a,this.domNode);var c=this.margin;var d=this.pointWidth;var e=this.pointHeight;var f=Math.round((b[0]-c-d/2)/d);var g=Math.round((b[1]-c-e/2)/e);return[f,g,b[0],b[1]]},crop:function(a){kingo.util.addClass(this.domContainer,"shrunk");this.domGutter.style.overflow="hidden";var b=a.width*this.pointWidth+this.margin*2;var c=a.height*this.pointHeight+this.margin*2;this.domGutter.style.width=b+"px";this.domGutter.style.height=c+"px";this.player.dom.player.style.width=b+"px";this.domGutter.scrollLeft=a.left*this.pointWidth;this.domGutter.scrollTop=a.top*this.pointHeight}};kingo.BoardRendererFlash=function(){this.init.apply(this,arguments)};kingo.BoardRendererFlash.prototype={init:function(a,b,c,d){if(!a){throw"No DOM container";return}this.ready=false;this.swf=null;this.unrendered=[];var e=a.id+"-board";var f=new SWFObject(kingo.playerPath+"/swf/board.swf",e,"421","421","8","#665544");f.addParam("allowScriptAccess","sameDomain");f.write(a);var g=0;var h=function(){swf=kingo.util.byId(e);if(!swf||!swf.init){if(g>2e3){throw"Error initializing board";return}setTimeout(arguments.callee.bind(this),10);g+=10;return}this.swf=swf;this.swf.init(c.uniq,b);this.ready=true}.bind(this);h()},showRegion:function(a){},hideRegion:function(){},clear:function(){if(!this.swf){return}this.swf.clear()},renderStone:function(a,b){if(!this.swf){this.unrendered.push(["stone",a,b]);return}for(var c=0;c<this.unrendered.length;c++){if(this.unrendered[c][0]=="stone"){this.swf.renderStone(this.unrendered[c][1],this.unrendered[c][2])}}this.unrendered=[];this.swf.renderStone(a,b)},renderMarker:function(a,b){if(!b){return}if(!this.swf){this.unrendered.push(["marker",a,b]);return}for(var c=0;c<this.unrendered.length;c++){if(this.unrendered[c][0]=="marker"){this.swf.renderMarker(this.unrendered[c][1],this.unrendered[c][2])}}this.unrendered=[];this.swf.renderMarker(a,b)},setCursor:function(a){},crop:function(){}};kingo.BoardRendererAscii=function(a,b){this.init(a,b)};kingo.BoardRendererAscii.prototype={pointWidth:2,pointHeight:1,margin:1,blankBoard:"+-------------------------------------+\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"|. . . . . . . . . . . . . . . . . . .|\n"+"+-------------------------------------+",init:function(a,b){this.domNode=a||null;this.boardSize=b||19;this.content=this.blankBoard},clear:function(){this.content=this.blankBoard;this.domNode.innerHTML="<pre>"+this.content+"</pre>"},renderStone:function(a,b){var c=(this.pointWidth*this.boardSize+this.margin*2)*(a.y*this.pointHeight+1)+a.x*this.pointWidth+2;this.content=this.content.substring(0,c-1)+"."+this.content.substring(c);if(b!="empty"){this.content=this.content.substring(0,c-1)+(b=="white"?"O":"#")+this.content.substring(c)}this.domNode.innerHTML="<pre>"+this.content+"</pre>"},renderMarker:function(a,b){}};kingo.Rules=function(a){this.init(a)};kingo.Rules.prototype={init:function(a){this.board=a;this.pendingCaptures=[]},check:function(a,b){if(this.board.getStone(a)!=this.board.EMPTY){return false}return true},apply:function(a,b){this.doCaptures(a,b)},doCaptures:function(a,b){var c=0;c+=this.doCapture({x:a.x-1,y:a.y},b);c+=this.doCapture({x:a.x+1,y:a.y},b);c+=this.doCapture({x:a.x,y:a.y-1},b);c+=this.doCapture({x:a.x,y:a.y+1},b);c-=this.doCapture(a,-b);if(c<0){b=-b;c=-c}b=b==this.board.WHITE?"W":"B";this.board.captures[b]+=c},doCapture:function(a,b){this.pendingCaptures=[];if(this.findCaptures(a,b)){return 0}var c=this.pendingCaptures.length;while(this.pendingCaptures.length){this.board.addStone(this.pendingCaptures.pop(),this.board.EMPTY)}return c},findCaptures:function(a,b){if(a.x<0||a.y<0||a.x>=this.board.boardSize||a.y>=this.board.boardSize){return 0}if(this.board.getStone(a)==b){return 0}if(this.board.getStone(a)==this.board.EMPTY){return 1}for(var c=0;c<this.pendingCaptures.length;c++){if(this.pendingCaptures[c].x==a.x&&this.pendingCaptures[c].y==a.y){return 0}}this.pendingCaptures.push(a);if(this.findCaptures({x:a.x-1,y:a.y},b)){return 1}if(this.findCaptures({x:a.x+1,y:a.y},b)){return 1}if(this.findCaptures({x:a.x,y:a.y-1},b)){return 1}if(this.findCaptures({x:a.x,y:a.y+1},b)){return 1}return 0}};(function(){var t=kingo.i18n,_2=kingo.util.byId,_3=kingo.util.ajax,_4=kingo.util.addEvent,_5=kingo.util.onClick,_6=kingo.util.getElClickXY,_7=kingo.util.stopEvent,_8=kingo.util.addClass,_9=kingo.util.removeClass,_a=kingo.util.show,_b=kingo.util.hide,_c=kingo.browser.moz,_d=kingo.util.getPlayerPath();kingo.players=kingo.players||{};kingo.delegate=function(a,b){var c=kingo.players[a];c[b].apply(c,Array.from(arguments).slice(2))};kingo.Player=function(){this.init.apply(this,arguments)};kingo.Player.prototype={init:function(a){a=a||{};this.mode=a.mode?a.mode:"play";this.dom={};this.dom.container=typeof a.container=="string"?_2(a.container):a.container;if(!this.dom.container){alert(t["dom error"]);return}this.uniq=(new Date).getTime();kingo.players[this.uniq]=this;this.sgfPath=a.sgfPath;this.searchUrl=a.searchUrl;this.showingSearch=false;this.saveUrl=a.saveUrl;this.downloadUrl=a.downloadUrl;this.scoreEstUrl=a.scoreEstUrl;this.hooks=a.hooks||{};this.permalinkable=!!this.hooks.setPermalink;this.propertyHandlers={W:this.playMove,B:this.playMove,KO:this.playMove,MN:this.setMoveNumber,AW:this.addStone,AB:this.addStone,AE:this.addStone,CR:this.addMarker,LB:this.addMarker,TR:this.addMarker,MA:this.addMarker,SQ:this.addMarker,TW:this.addMarker,TB:this.addMarker,DD:this.addMarker,PL:this.setColor,C:this.showComments,N:this.showAnnotation,GB:this.showAnnotation,GW:this.showAnnotation,DM:this.showAnnotation,HO:this.showAnnotation,UC:this.showAnnotation,V:this.showAnnotation,BM:this.showAnnotation,DO:this.showAnnotation,IT:this.showAnnotation,TE:this.showAnnotation,BL:this.showTime,OB:this.showTime,WL:this.showTime,OW:this.showTime};this.infoLabels={GN:t["game"],PW:t["white"],WR:t["white rank"],WT:t["white team"],PB:t["black"],BR:t["black rank"],BT:t["black team"],HA:t["handicap"],KM:t["komi"],RE:t["result"],DT:t["date"],GC:t["info"],PC:t["place"],EV:t["event"],RO:t["round"],OT:t["overtime"],ON:t["opening"],RU:t["ruleset"],AN:t["annotator"],CP:t["copyright"],SO:t["source"],TM:t["time limit"],US:t["transcriber"],AP:t["created with"]};this.months=[t["january"],t["february"],t["march"],t["april"],t["may"],t["june"],t["july"],t["august"],t["september"],t["october"],t["november"],t["december"]];this.theme=a.theme;this.reset(a);this.renderer=a.renderer||"html";this.cropParams=null;this.shrinkToFit=a.shrinkToFit;if(this.shrinkToFit||a.cropWidth||a.cropHeight){this.cropParams={};this.cropParams.width=a.cropWidth;this.cropParams.height=a.cropHeight;this.cropParams.left=a.cropLeft;this.cropParams.top=a.cropTop;this.cropParams.padding=a.cropPadding||1}this.constructDom();if(a.enableShortcuts){_4(document,_c?"keypress":"keydown",this.handleKeypress,this,true)}_4(document,"mouseup",this.handleDocMouseUp,this,true);if(a.sgf||a.sgfUrl||a.sgfPath&&a.gameName){this.loadSgf(a)}this.hook("initDone")},hook:function(a,b){if(a in this.hooks){return this.hooks[a].bind(this)(b)}},reset:function(a){this.gameName="";this.collectionRoot=new kingo.GameNode;this.cursor=new kingo.GameCursor;this.progressiveLoad=a.progressiveLoad?true:false;this.progressiveLoads=null;this.progressiveUrl=null;this.progressiveMode=a.progressiveLoad&&a.progressiveMode||"id";this.opponentUrl=null;this.opponentColor=null;this.opponentLevel=null;this.board=null;this.rules=null;this.currentColor=null;this.moveNumber=null;this.totalMoves=null;this.variations=null;this.timeB="";this.timeW="";this.regionTop=null;this.regionLeft=null;this.regionWidth=null;this.regionHeight=null;this.regionBegun=null;this.regionClickSelect=null;this.mouseDown=null;this.mouseDownX=null;this.mouseDownY=null;this.mouseDownClickX=null;this.mouseDownClickY=null;this.labelLastLetter=null;this.labelLastNumber=null;this.resetLastLabels();this.unsavedChanges=false;this.updatedNavTree=false;this.navTreeTimeout=null;this.searching=false;this.editingText=false;this.goingBack=false;this.problemMode=a.problemMode;this.problemColor=a.problemColor;this.prefs={};this.prefs.markCurrent=typeof a.markCurrent!="undefined"?!!a.markCurrent:true;this.prefs.markNext=typeof a.markNext!="undefined"?a.markNext:false;this.prefs.markVariations=typeof a.markVariations!="undefined"?!!a.markVariations:true;this.prefs.showGameInfo=!!a.showGameInfo;this.prefs.showPlayerInfo=!!a.showPlayerInfo;this.prefs.showTools=!!a.showTools;this.prefs.showComments=typeof a.showComments!="undefined"?!!a.showComments:true;this.prefs.showOptions=!!a.showOptions;this.prefs.showNavTree=!this.progressiveLoad&&typeof a.showNavTree!="undefined"?!!a.showNavTree:false},loadSgf:function(a,b){a=a||{};this.nowLoading();this.reset(a);this.sgfPath=a.sgfPath||this.sgfPath;this.loadPath=a.loadPath&&a.loadPath.length>1?a.loadPath:[0,0];this.gameName=a.gameName||"";var c=false;if(typeof a.sgf=="string"){var d=new kingo.SgfParser(a.sgf);this.load(d.root)}else{if(typeof a.sgf=="object"){this.load(a.sgf)}else{if(a.progressiveLoad&&a.progressiveUrl){this.progressiveLoads=0;this.progressiveUrl=a.progressiveUrl;this.fetchProgressiveData(b);c=true}else{if(typeof a.sgfUrl=="string"||this.gameName){if(!a.sgfUrl){a.sgfUrl=this.sgfPath+this.gameName+".sgf"}this.remoteLoad(a.sgfUrl,null,false,null,b);c=true;if(a.progressiveLoad){this.progressiveLoads=0;this.progressiveUrl=a.progressiveUrl||a.sgfUrl.replace(/\?.+$/,"")}}else{var e=a.boardSize||"19";var f={19:6.5,13:4.5,9:3.5,7:2.5};var g={_children:[{SZ:e,KM:a.komi||f[e]||6.5,_children:[]}]};if(a.opponentUrl){this.gameName="gnugo";this.opponentUrl=a.opponentUrl;this.opponentColor=a.opponentColor=="B"?a.opponentColor:"W";this.opponentLevel=a.opponentLevel||7;var h=g._children[0];h.PW=this.opponentColor=="B"?t["you"]:"GNU Go";h.PB=this.opponentColor=="B"?"GNU Go":t["you"];h.HA=parseInt(a.handicap,10)||0;if(h.HA){var i={19:[["pd","dp"],["pd","dp","pp"],["pd","dp","pp","dd"],["pd","dp","pp","dd","jj"],["pd","dp","pp","dd","dj","pj"],["pd","dp","pp","dd","dj","pj","jj"],["pd","dp","pp","dd","dj","pj","jd","jp"],["pd","dp","pp","dd","dj","pj","jd","jp","jj"]],13:[["jd","dj"],["jd","dj","jj"],["jd","dj","jj","dd"],["jd","dj","jj","dd","gg"],["jd","dj","jj","dd","dg","jg"],["jd","dj","jj","dd","dg","jg","gg"],["jd","dj","jj","dd","dg","jg","gd","gj"],["jd","dj","jj","dd","dg","jg","gd","gj","gg"]],9:[["cg","gc"],["cg","gc","gg"],["cg","gc","gg","cc"],["cg","gc","gg","cc","ee"],["cg","gc","gg","cc","ce","ge"],["cg","gc","gg","cc","ce","ge","ee"],["cg","gc","gg","cc","ce","ge","ec","eg"],["cg","gc","gg","cc","ce","ge","ec","eg","ee"]]};h.KM=.5;if(h.HA>1){h.AB=i[e][h.HA-2]}}}this.load(g)}}}}if(!c&&typeof b=="function"){b()}},load:function(a,b){var c=false;if(!b){b=new kingo.GameNode;this.collectionRoot=b}b.loadJson(a);b._cached=true;this.doneLoading();this.progressiveLoads--;if(!b._parent){var d=this.loadPath.length?parseInt(this.loadPath[0],10):0;this.initGame(b._children[d||0]);c=true}if(this.loadPath.length){this.goTo(this.loadPath,c);if(!this.progressiveLoad){this.loadPath=[0,0]}}else{this.refresh()}if(c&&this.problemMode){if(!this.problemColor){this.currentColor=this.problemColor=this.cursor.getNextColor()||"B"}else{this.currentColor=this.problemColor}}},remoteLoad:function(url,_23,_24,_25,_26){_24=_24=="undefined"?true:_24;_26=typeof _26=="function"?_26:null;if(_24){if(!_23){this.gameName=url}url=this.sgfPath+url+".sgf"}if(_25){this.loadPath=_25}var _27=function(req){var _29=req.responseText.replace(/^( |\t|\r|\n)*/,"");if(_29.charAt(0)=="("){var me=this;var sgf=new kingo.SgfParser(_29,function(){me.load(this.root,_23);_26&&_26()})}else{if(_29.charAt(0)=="{"){_29=eval("("+_29+")");this.load(_29,_23);_26&&_26()}else{this.croak(t["invalid data"])}}};var _2c=function(a){this.croak(t["error retrieving"])};_3("get",url,null,_27,_2c,this,3e4)},initGame:function(a){a=a||{};this.handleDisplayPrefs();var b=a.SZ||19;if(b!=7&&b!=9&&b!=13&&b!=19){b=19}if(this.shrinkToFit){this.calcShrinkToFit(a,b)}else{if(this.problemMode&&!this.cropParams){this.cropParams={width:b,height:b,top:0,left:0,padding:1}}}if(!this.board){this.createBoard(b);this.rules=new kingo.Rules(this.board)}this.unsavedChanges=false;this.resetCursor(true);this.totalMoves=0;var c=new kingo.GameCursor(this.cursor.node);while(c.next()){this.totalMoves++}this.totalMoves--;this.showGameInfo(a);this.enableNavSlider();this.selectTool(this.mode=="view"?"view":"play");this.hook("initGame")},handleDisplayPrefs:function(){(this.prefs.showGameInfo||this.prefs.showPlayerInfo?_a:_b)(this.dom.info);(this.prefs.showGameInfo?_a:_b)(this.dom.infoGame);(this.prefs.showPlayerInfo?_a:_b)(this.dom.infoPlayers);(this.prefs.showTools?_a:_b)(this.dom.toolsContainer);if(!this.showingSearch){(this.prefs.showComments?_a:_b)(this.dom.comments)}(this.prefs.showOptions?_a:_b)(this.dom.options);(this.prefs.showNavTree?_a:_b)(this.dom.navTreeContainer)},createBoard:function(a){a=a||19;if(this.board&&this.board.renderer&&this.board.boardSize==a){return}try{this.dom.boardContainer.innerHTML="";var b=this.renderer=="flash"?kingo.BoardRendererFlash:kingo.BoardRendererHtml;var c=new b(this.dom.boardContainer,a,this,this.cropParams);this.board=new kingo.Board(c,a)}catch(d){if(d=="No DOM container"){this.croak(t["error board"]);return}}},calcShrinkToFit:function(a,b){var c=null,d=null,e=null,f=null;var g={};var h=this;a.walk(function(a){var b,c,d;for(b in a){if(/^(W|B|AW|AB|LB)$/.test(b)){d=a[b];if(!(d instanceof Array)){d=[d]}if(b!="LB"){d=h.expandCompressedPoints(d)}else{d=[d[0].split(/:/)[0]]}for(c=0;c<d.length;c++){g[d[c]]=""}}}});for(var i in g){var j=this.sgfCoordToPoint(i);if(c==null||j.x<c){c=j.x}if(e==null||j.x>e){e=j.x}if(d==null||j.y<d){d=j.y}if(f==null||j.y>f){f=j.y}}this.cropParams.width=e-c+1;this.cropParams.height=f-d+1;this.cropParams.left=c;this.cropParams.top=d;var k=this.cropParams.padding;for(var l=k;c-l<0;l--){}if(l){this.cropParams.width+=l;this.cropParams.left-=l}for(var m=k;d-m<0;m--){}if(m){this.cropParams.height+=m;this.cropParams.top-=m}for(var n=k;e+n>b;n--){}if(n){this.cropParams.width+=n}for(var o=k;f+o>b;o--){}if(o){this.cropParams.height+=o}},fetchOpponentMove:function(){this.nowLoading(t["gnugo thinking"]);var a=function(a){this.doneLoading();this.createMove(a.responseText)};var b=function(a){this.croak(t["error retrieving"])};var c=this.cursor.getGameRoot();var d={sgf:c.toSgf(),move:this.currentColor,size:c.SZ,level:this.opponentLevel};_3("post",this.opponentUrl,d,a,b,this,45e3)},fetchScoreEstimate:function(){this.nowLoading(t["gnugo thinking"]);var a=function(a){this.doneLoading();var b=a.responseText.split("\n");var c,d=b[1].split(" ");for(var e=0;e<d.length;e++){c=d[e].split(":");if(c[1]){this.addMarker(c[1],c[0])}}this.board.render();this.prependComment(b[0])};var b=function(a){this.croak(t["error retrieving"])};var c=this.cursor.getGameRoot();var d={sgf:c.toSgf(),move:"est",size:c.SZ||19,komi:c.KM||0,mn:this.moveNumber+1};_3("post",this.scoreEstUrl,d,a,b,this,45e3)},playProblemResponse:function(a){setTimeout(function(){this.variation(null,a);if(this.hooks.playProblemResponse){this.hook("playProblemResponse")}else{if(!this.cursor.hasNext()){this.prependComment(t["end of variation"])}}}.bind(this),200)},goTo:function(a,b){b=typeof b!="undefined"?b:true;if(b&&a.length>1&&a[0]!=this.cursor.getGameRoot().getPosition()){this.updatedNavTree=false}if(b){this.resetCursor(true)}var c=parseInt(a,10);if(!(a instanceof Array)&&!isNaN(c)){if(b){c++}for(var d=0;d<c;d++){this.variation(null,true)}this.refresh();return}if(!(a instanceof Array)||!a.length){alert(t["bad path"]+" "+a);return}var e;var f;if(isNaN(parseInt(a[0],10))){if(!this.cursor.node._parent){this.variation(0,true)}while(a.length){if(this.progressiveLoads>0){this.loadPath.push(e);return}e=a.shift();f=this.getVariations();for(var d=0;d<f.length;d++){if(f[d].move==e){this.variation(f[d].varNum,true);break}}}this.refresh();return}var g=true;while(a.length){e=parseInt(a.shift(),10);if(!a.length){for(var d=0;d<e;d++){this.variation(0,true)}}else{if(a.length){if(!g&&b){while(this.cursor.node._children.length==1){this.variation(0,true)}}this.variation(e,true)}}g=false}this.refresh()},resetCursor:function(a,b){this.board.reset();this.resetCurrentColor();if(b){this.cursor.node=this.cursor.getGameRoot()}else{this.cursor.node=this.collectionRoot}this.refresh(a)},resetCurrentColor:function(){this.currentColor=this.problemMode?this.problemColor:"B";var a=this.cursor.getGameRoot();if(a&&a.HA>1){this.currentColor="W"}},refresh:function(a){if(this.progressiveLoads>0){var b=this;setTimeout(function(){b.refresh.call(b)},10);return}this.board.revert(1);this.execNode(a)},variation:function(a,b){if(this.cursor.next(a)){this.execNode(b);this.resetLastLabels();if(this.progressiveLoads>0){return false}return true}return false},execNode:function(a,b){if(!b&&this.progressiveLoads>0){var c=this;setTimeout(function(){c.execNode.call(c,a)},10);return}if(!this.cursor.node){return}if(!a){this.dom.comments.innerHTML="";this.board.clearMarkers();this.moveNumber=this.cursor.getMoveNumber()}if(this.moveNumber<1){this.resetCurrentColor()}var d=this.cursor.node.getProperties();for(var e in d){if(this.propertyHandlers[e]){this.propertyHandlers[e].apply(this,[this.cursor.node[e],e,a])}}if(a){this.board.commit()}else{if(this.opponentUrl&&this.opponentColor==this.currentColor&&this.moveNumber==this.totalMoves){this.fetchOpponentMove()}this.findVariations();this.updateControls();this.board.commit();this.board.render()}if(!b&&this.progressiveUrl){this.fetchProgressiveData()}if(this.problemMode&&this.currentColor&&this.currentColor!=this.problemColor&&!this.goingBack){this.playProblemResponse(a)}this.goingBack=false},fetchProgressiveData:function(a){var b=this.cursor.node||null;if(b&&b._cached){return}if(this.progressiveMode=="pattern"){if(b&&!b._parent._parent){return}this.fetchProgressiveContinuations(a)}else{var c=b&&b._id||0;this.nowLoading();this.progressiveLoads++;var d=function(){var b=this.cursor.getMoveNumber();if(b>1){this.cursor.node.C="<a id='cont-search' href='#'>"+t["show games"]+"</a>"+(this.cursor.node.C||"")}this.refresh();if(a&&typeof a=="function"){a()}_4(_2("cont-search"),"click",function(a){var b=8;var c=this.board.getRegion(0,19-b,b,b);var d=this.convertRegionPattern(c);this.loadSearch("ne",b+"x"+b,this.compressPattern(d));_7(a)}.bind(this))}.bind(this);var e=this.progressiveUrl+"?"+kingo.util.makeQueryString({id:c,pid:this.uniq});this.remoteLoad(e,b,false,null,d)}},fetchProgressiveContinuations:function(_74){this.nowLoading();this.progressiveLoads++;var _75=this.cursor.getMoveNumber();var _76=_75>1?11:7;var _77=19-_76-1;var _78=this.board?this.convertRegionPattern(this.board.getRegion(0,_77+1,_76,_76)):".................................................";var _79={q:"ne",w:_76,h:_76,p:_78,a:"continuations",t:(new Date).getTime()};var _7a=function(a){this.croak(t["error retrieving"])};var _7c=function(req){if(!req.responseText||req.responseText=="NONE"){this.progressiveLoads--;this.doneLoading();this.cursor.node._cached=true;this.refresh();return}var _7e={LB:[],_children:[]},_7f;_7e.C=_75>1?"<a id='cont-search' href='#'>"+t["show games"]+"</a>":"";var _80,_81=eval("("+req.responseText+")");if(_81.length){_81.sort(function(a,b){return parseInt(b.count,10)-parseInt(a.count,10)});var _84=parseInt(_81[0].count,10);var x,y,_87,_88;_7e.C+="<div class='continuations'>";for(var i=0;_80=_81[i];i++){_88=parseInt(_80.count/_84*150);if(_84>20&&parseInt(_80.count,10)<10){continue}_7f={};x=_77+parseInt(_80.x,10)+1;y=parseInt(_80.y,10);_87=this.pointToSgfCoord({x:x,y:y});_7f[this.currentColor||"B"]=_87;_7e.LB.push(_87+":"+_80.label);if(_88){_7e.C+="<div class='continuation'>"+"<div class='cont-label'>"+_80.label+"</div>"+"<div class='cont-bar' style='width: "+_88+"px'></div>"+"<div class='cont-count'>"+_80.count+"</div>"+"</div>"}_7e._children.push(_7f)}_7e.C+="</div>";if(!this.cursor.node){_7e={_children:[_7e]}}}this.load(_7e,this.cursor.node);_4(_2("cont-search"),"click",function(a){this.loadSearch("ne",_76+"x"+_76,this.compressPattern(_78));_7(a)}.bind(this));if(_74&&typeof _74=="function"){_74()}}.bind(this);_3("get",this.progressiveUrl,_79,_7c,_7a,this,45e3)},findVariations:function(){this.variations=this.getVariations()},getVariations:function(){var a=[],b=this.cursor.node._children;for(var c=0;c<b.length;c++){a.push({move:b[c].getMove(),varNum:c})}return a},back:function(a,b,c){if(this.cursor.previous()){this.board.revert(1);this.goingBack=true;this.refresh(c);this.resetLastLabels()}},forward:function(a,b,c){this.variation(null,c)},first:function(){if(!this.cursor.hasPrevious()){return}this.resetCursor(false,true)},last:function(){if(!this.cursor.hasNext()){return}while(this.variation(null,true)){}this.refresh()},pass:function(){if(!this.variations){return}for(var a=0;a<this.variations.length;a++){if(!this.variations[a].move||this.variations[a].move=="tt"){this.variation(this.variations[a].varNum);return}}this.createMove("tt")},handleBoardMouseDown:function(a,b,c,d,e){if(this.domLoading){return}if(!this.boundsCheck(a,b,[0,this.board.boardSize-1])){return}this.mouseDown=true;this.mouseDownX=a;this.mouseDownY=b;this.mouseDownClickX=c;this.mouseDownClickY=d;if(this.mode=="region"&&a>=0&&b>=0&&!this.regionBegun){this.regionTop=b;this.regionLeft=a;this.regionBegun=true}},handleBoardHover:function(a,b,c,d,e){if(this.domLoading){return}if(this.mouseDown||this.regionBegun){if(!this.boundsCheck(a,b,[0,this.board.boardSize-1])){return}var f=a!=this.mouseDownX||b!=this.mouseDownY;var g=Math.abs(this.mouseDownClickX-c)>=19||Math.abs(this.mouseDownClickY-d)>=19;if(this.searchUrl&&!this.regionBegun&&f&&g){this.selectTool("region");this.regionBegun=true;this.regionTop=this.mouseDownY;this.regionLeft=this.mouseDownX}if(this.regionBegun){this.regionRight=a+(a>=this.regionLeft?1:0);this.regionBottom=b+(b>=this.regionTop?1:0);this.showRegion()}_7(e)}},handleBoardMouseUp:function(a,b,c){if(this.domLoading){return}this.mouseDown=false;var d=this.pointToSgfCoord({x:a,y:b});if(this.mode=="view"||this.mode=="play"){for(var e=0;e<this.variations.length;e++){var f=this.sgfCoordToPoint(this.variations[e].move);if(f.x==a&&f.y==b){this.variation(this.variations[e].varNum);_7(c);return}}}if(this.mode=="view"){var g=this.cursor.getGameRoot(),h=[0,g.getPosition()],i=0,j=g._children[0];while(j){if(j.getMove()==d){h.push(i);this.goTo(h);break}i++;j=j._children[0]}return}if(this.mode=="play"){if(!this.rules.check({x:a,y:b},this.currentColor)){return}if(d){var k=this.cursor.getNextMoves();if(k&&d in k){this.variation(k[d])}else{this.createMove(d)}}}else{if(this.mode=="region"&&a>=-1&&b>=-1&&this.regionBegun){if(this.regionTop==b&&this.regionLeft==a&&!this.regionClickSelect){this.regionClickSelect=true;this.regionRight=a+1;this.regionBottom=b+1;this.showRegion()}else{this.regionBegun=false;this.regionClickSelect=false;this.regionBottom=b<0?0:b>=this.board.boardSize?b:b+(b>this.regionTop?1:0);this.regionRight=a<0?0:a>=this.board.boardSize?a:a+(a>this.regionLeft?1:0);this.showRegion();_a(this.dom.searchButton,"inline");_7(c)}}else{var l;var m=this.board.getStone({x:a,y:b});if(this.mode=="add_b"||this.mode=="add_w"){var n=this.cursor.node.emptyPoint(this.pointToSgfCoord({x:a,y:b}));if(m!=this.board.BLACK&&this.mode=="add_b"){l="AB"}else{if(m!=this.board.WHITE&&this.mode=="add_w"){l="AW"}else{if(this.board.getStone({x:a,y:b})!=this.board.EMPTY&&!n){l="AE"}}}}else{switch(this.mode){case"tr":l="TR";break;case"sq":l="SQ";break;case"cr":l="CR";break;case"x":l="MA";break;case"dim":l="DD";break;case"number":l="LB";d=d+":"+this.labelLastNumber;this.labelLastNumber++;break;case"letter":l="LB";d=d+":"+this.labelLastLetter;this.labelLastLetter=String.fromCharCode(this.labelLastLetter.charCodeAt(0)+1);break;case"label":l="LB";d=d+":"+this.dom.labelInput.value;break;case"clear":this.cursor.node.deletePropertyValue(["TR","SQ","CR","MA","DD","LB"],new RegExp("^"+d));break}if(this.cursor.node.hasPropertyValue(l,d)){this.cursor.node.deletePropertyValue(l,d);l=null}}if(l){this.cursor.node.pushProperty(l,d)}this.unsavedChanges=true;var n=this.checkForEmptyNode();this.refresh();if(n){this.prependComment(t["position deleted"])}}}},checkForEmptyNode:function(){if(!kingo.util.numProperties(this.cursor.node.getProperties())){var a=window.confirm(t["confirm delete"]);if(a){var b=this.cursor.node._id;var c=0;this.back();this.cursor.node._children=this.cursor.node._children.filter(function(a,d){if(a._id==b){c=d;return false}else{return true}});if(c&&this.cursor.node._preferredChild==c){this.cursor.node._preferredChild--}return true}}return false},handleDocMouseUp:function(a){if(this.domLoading){return true}if(this.mode=="region"&&this.regionBegun&&!this.regionClickSelect){this.mouseDown=false;this.regionBegun=false;_a(this.dom.searchButton,"inline")}return true},boundsCheck:function(a,b,c){if(c.length==2){c[3]=c[2]=c[1];c[1]=c[0]}return a>=c[0]&&b>=c[1]&&a<=c[2]&&b<=c[3]},getRegionBounds:function(){var a=this.regionLeft;var b=this.regionRight-this.regionLeft;if(b<0){a=this.regionRight;b=-b+1}var c=this.regionTop;var d=this.regionBottom-this.regionTop;if(d<0){c=this.regionBottom;d=-d+1}return[c,a,b,d]},showRegion:function(){var a=this.getRegionBounds();this.board.renderer.showRegion(a)},hideRegion:function(){this.board.renderer.hideRegion()},convertRegionPattern:function(a){return a.join("").replace(new RegExp(this.board.EMPTY,"g"),".").replace(new RegExp(this.board.BLACK,"g"),"x").replace(new RegExp(this.board.WHITE,"g"),"o")},loadSearch:function(a,b,c,d,e){var f={_children:[{SZ:this.board.boardSize,_children:[]}]};this.load(f);d=d||"corner";this.dom.searchAlgo.value=d;c=this.uncompressPattern(c);b=b.split("x");var g=b[0];var h=b[1];var i=this.board.boardSize;var j;var k;switch(a){case"nw":j=0;k=0;break;case"ne":j=i-g;k=0;break;case"se":j=i-g;k=i-h;break;case"sw":j=0;k=i-h;break}var l;var m;var n;for(n=0;n<h;n++){for(m=0;m<g;m++){l=c.charAt(n*g+m);if(l=="o"){l="AW"}else{if(l=="x"){l="AB"}else{l=""}}this.cursor.node.pushProperty(l,this.pointToSgfCoord({x:j+m,y:k+n}))}}this.refresh();this.regionLeft=j;this.regionTop=k;this.regionRight=j+m;this.regionBottom=k+n;var o=this.getRegionBounds();var p=[o[1],o[0],o[1]+o[2],o[0]+o[3]-1];for(n=0;n<this.board.boardSize;n++){for(m=0;m<this.board.boardSize;m++){if(!this.boundsCheck(m,n,p)){this.board.renderer.renderMarker({x:m,y:n},"dim")}}}this.searchRegion(e)},searchRegion:function(_ce){if(this.searching){return}this.searching=true;if(!this.searchUrl){_a(this.dom.comments);_b(this.dom.searchContainer);this.prependComment(t["no search url"]);return}var _ce=parseInt(_ce,10)||0;var _cf=this.dom.searchAlgo.value;var _d0=this.getRegionBounds();var _d1=this.board.getRegion(_d0[0],_d0[1],_d0[2],_d0[3]);var _d2=this.convertRegionPattern(_d1);var _d3=/^\.*$/.test(_d2);var _d4=/^\.*o\.*$/.test(_d2);var _d5=/^\.*x\.*$/.test(_d2);if(_d3||_d4||_d5){this.searching=false;_a(this.dom.comments);_b(this.dom.searchContainer);this.prependComment(t["two stones"]);return}var _d6=[];if(_d0[0]==0){_d6.push("n")}if(_d0[1]==0){_d6.push("w")}if(_d0[0]+_d0[3]==this.board.boardSize){_d6.push("s")}if(_d0[1]+_d0[2]==this.board.boardSize){_d6.push("e")}if(_cf=="corner"&&!(_d6.length==2&&(_d6.contains("n")&&_d6.contains("e")||_d6.contains("n")&&_d6.contains("w")||_d6.contains("s")&&_d6.contains("e")||_d6.contains("s")&&_d6.contains("w")))){this.searching=false;_a(this.dom.comments);_b(this.dom.searchContainer);this.prependComment(t["two edges"]);return}var _d7=_d6.contains("n")?"n":"s";_d7+=_d6.contains("w")?"w":"e";this.showComments("");this.gameName="search";var _d8=function(req){this.searching=false;this.doneLoading();_b(this.dom.comments);_a(this.dom.searchContainer);this.showingSearch=true;if(req.responseText=="ERROR"){this.croak(t["error retrieving"]);return}else{if(req.responseText=="NONE"){_b(this.dom.searchResultsContainer);this.dom.searchCount.innerHTML="No";return}}var ret=eval("("+req.responseText+")");var _db=ret.results,_dc,_dd="",odd,_df=parseInt(ret.total,10),_e0=parseInt(ret.offset,10)+1,_e1=parseInt(ret.offset,10)+50;for(var i=0;_dc=_db[i];i++){odd=odd?false:true;_dd+="<a class='search-result"+(odd?" odd":"")+"' href='#'>                    <span class='id'>"+_dc.id+"</span>                    <span class='mv'>"+_dc.mv+"</span>                    <span class='pw'>"+_dc.pw+" "+_dc.wr+"</span>                    <span class='pb'>"+_dc.pb+" "+_dc.br+"</span>                    <span class='re'>"+_dc.re+"</span>                    <span class='dt'>"+_dc.dt+"</span>                    <div class='clear'> </div>                    </a>"}if(_df>_e1){_dd+="<div class='search-more'><a href='#' id='search-more'>Show more...</a></div>"}_a(this.dom.searchResultsContainer);this.dom.searchResults.innerHTML=_dd+"<br>";this.dom.searchCount.innerHTML=_df;this.dom.searchOffsetStart.innerHTML=_e0;this.dom.searchOffsetEnd.innerHTML=_df<_e1?_df:_e1;this.dom.searchContainer.scrollTop=0;if(_df>_e1){setTimeout(function(){_4(_2("search-more"),"click",function(a){this.loadSearch(_d7,_d0[2]+"x"+_d0[3],_d2,"corner",ret.offset+51);_7(a)}.bind(this))}.bind(this),0)}};var _e4=function(a){this.croak(t["error retrieving"])};var _e6={q:_d7,w:_d0[2],h:_d0[3],p:_d2,a:_cf,o:_ce,t:(new Date).getTime()};this.progressiveLoad=false;this.progressiveUrl=null;this.prefs.markNext=false;this.prefs.showPlayerInfo=true;this.hook("searchRegion",_e6);this.nowLoading();_3("get",this.searchUrl,_e6,_d8,_e4,this,45e3)},loadSearchResult:function(a){this.nowLoading();var b=a.target||a.srcElement;if(b.nodeName=="SPAN"){b=b.parentNode}if(b.nodeName=="A"){var c;var d;var e;for(var f=0;c=b.childNodes[f];f++){if(c.className=="id"){d=c.innerHTML}if(c.className=="mv"){e=parseInt(c.innerHTML,10)}}}this.remoteLoad(d,null,true,[0,e],function(){this.doneLoading();this.setPermalink();this.prefs.showOptions=true;this.handleDisplayPrefs()}.bind(this));_7(a)},closeSearch:function(){this.showingSearch=false;_b(this.dom.searchContainer);_a(this.dom.comments)},compressPattern:function(a){var b=null;var c="";var d=1;var e="";for(var f=0;f<a.length;f++){b=a.charAt(f);if(b==c){d++}else{e=e+c+(d>1?d:"");d=1;c=b}}e=e+c+(d>1?d:"");return e},uncompressPattern:function(a){var b=null;var c=null;var d="";var e="";for(var f=0;f<a.length;f++){b=a.charAt(f);if(b=="."||b=="x"||b=="o"){if(c!=null){d=parseInt(d,10);d=isNaN(d)?1:d;for(var g=0;g<d;g++){e+=c}d=""}c=b}else{d+=b}}d=parseInt(d,10);d=isNaN(d)?1:d;for(var g=0;g<d;g++){e+=c}return e},createMove:function(a){var b={};b[this.currentColor]=a;var c=new kingo.GameNode(null,b);c._cached=true;this.totalMoves++;this.cursor.node.appendChild(c);this.unsavedChanges=[this.cursor.node._children.last(),this.cursor.node];this.updatedNavTree=false;this.variation(this.cursor.node._children.length-1)},handleKeypress:function(a){if(this.editingText){return true}var b=a.keyCode||a.charCode;if(!b||a.ctrlKey||a.altKey||a.metaKey){return true}var c=String.fromCharCode(b).toLowerCase();var d=[];for(var e=0;e<this.variations.length;e++){var f=this.variations[e].move;var g=this.sgfCoordToPoint(f);var h=""+(e+1);var i=this.board.getMarker(g);if(g.x!=null&&i!=this.board.EMPTY&&typeof i=="string"&&!d.contains(f)){h=i.toLowerCase()}h=h.replace(/^var:/,"");if(c==h.charAt(0)){this.variation(this.variations[e].varNum);_7(a);return}d.push(f)}if(b==112||b==27){this.selectTool("play")}var j=true;switch(b){case 39:if(a.shiftKey){var k=this.totalMoves-this.moveNumber;var l=k>9?9:k-1;for(var e=0;e<l;e++){this.forward(null,null,true)}}this.forward();break;case 37:if(a.shiftKey){var l=this.moveNumber>9?9:this.moveNumber-1;for(var e=0;e<l;e++){this.back(null,null,true)}}this.back();break;case 40:this.last();break;case 38:this.first();break;case 192:this.pass();break;default:j=false;break}if(j){_7(a)}},showGameInfo:function(a){this.hook("showGameInfo",a);if(!a){return}this.dom.infoGame.innerHTML="";this.dom.whiteName.innerHTML="";this.dom.blackName.innerHTML="";var b=document.createElement("dl"),c;for(var d in this.infoLabels){if(a[d]instanceof Array){a[d]=a[d][0]}if(a[d]){if(d=="PW"){this.dom.whiteName.innerHTML=a[d]+(a["WR"]?", "+a["WR"]:"");continue}else{if(d=="PB"){this.dom.blackName.innerHTML=a[d]+(a["BR"]?", "+a["BR"]:"");continue}}if(d=="WR"||d=="BR"){continue}c=a[d];if(d=="DT"){var e=a[d].split(/[\.-]/);if(e.length==3){c=e[2].replace(/^0+/,"")+" "+this.months[e[1]-1]+" "+e[0]}}var f=document.createElement("dt");f.innerHTML=this.infoLabels[d]+":";var g=document.createElement("dd");g.innerHTML=c;b.appendChild(f);b.appendChild(g)}}this.dom.infoGame.appendChild(b)},selectTool:function(a){var b;_b(this.dom.scoreEst);_b(this.dom.labelInput);if(a=="region"){b="crosshair"}else{if(a=="comment"){this.startEditComment()}else{if(a=="gameinfo"){this.startEditGameInfo()}else{if(a=="label"){_a(this.dom.labelInput,"inline");this.dom.labelInput.focus()}else{b="default";this.regionBegun=false;this.hideRegion();_b(this.dom.searchButton);_b(this.dom.searchAlgo);if(this.searchUrl){_a(this.dom.scoreEst,"inline")}}}}}this.board.renderer.setCursor(b);this.mode=a;this.dom.toolsSelect.value=a},startEditComment:function(){this.closeSearch();var a=this.dom.commentsEdit;a.style.position="absolute";a.style.top=this.dom.comments.offsetTop+"px";a.style.left=this.dom.comments.offsetLeft+"px";_a(this.dom.shade);this.dom.comments.innerHTML="";_a(a);_a(this.dom.commentsEditDone);this.dom.commentsEditTa.value=this.cursor.node.C||"";this.dom.commentsEditTa.focus();this.editingText=true},finishEditComment:function(){this.editingText=false;var a=this.cursor.node.C;var b=this.dom.commentsEditTa.value;if(a!=b){this.unsavedChanges=true;this.cursor.node.C=b}if(!this.cursor.node.C){delete this.cursor.node.C}_b(this.dom.shade);_b(this.dom.commentsEdit);_a(this.dom.comments);this.selectTool("play");var c=this.checkForEmptyNode();this.refresh();if(c){this.prependComment(t["position deleted"])}},startEditGameInfo:function(){this.closeSearch();var a=this.dom.gameInfoEdit;a.style.position="absolute";a.style.top=this.dom.comments.offsetTop+"px";a.style.left=this.dom.comments.offsetLeft+"px";_a(this.dom.shade);this.dom.comments.innerHTML="";_a(a);_a(this.dom.gameInfoEditDone);var b=this.cursor.getGameRoot();var c=["<table>"];for(var d in this.infoLabels){c.push("<tr><td>"+this.infoLabels[d]+":"+"</td><td>"+'<input type="text" id="game-info-edit-field-'+d+'"'+' value="'+(b[d]||"")+'">'+"</td></tr>")}c.push("</table>");this.dom.gameInfoEditForm.innerHTML=c.join("");setTimeout(function(){_2("game-info-edit-field-GN").focus()},0);this.editingText=true},finishEditGameInfo:function(){this.editingText=false;_b(this.dom.shade);_b(this.dom.gameInfoEdit);_a(this.dom.comments);var a=this.cursor.getGameRoot();var b=null;for(var c in this.infoLabels){b=_2("game-info-edit-field-"+c).value;if((a[c]||"")!=b){a[c]=b;this.unsavedChanges=true}}this.showGameInfo(a);this.dom.gameInfoEditForm.innerHTML="";this.selectTool("play");this.refresh()},updateControls:function(){this.dom.moveNumber.innerHTML=this.moveNumber?t["move"]+" "+this.moveNumber:this.permalinkable?"permalink":"";this.dom.whiteCaptures.innerHTML=t["captures"]+": <span>"+this.board.captures.W+"</span>";this.dom.blackCaptures.innerHTML=t["captures"]+": <span>"+this.board.captures.B+"</span>";this.dom.whiteTime.innerHTML=t["time left"]+": <span>"+(this.timeW?this.timeW:"--")+"</span>";this.dom.blackTime.innerHTML=t["time left"]+": <span>"+(this.timeB?this.timeB:"--")+"</span>";_9(this.dom.controlPass,"pass-on");this.dom.variations.innerHTML="";for(var a=0;a<this.variations.length;a++){var b=a+1;var c=false;if(!this.variations[a].move||this.variations[a].move=="tt"){_8(this.dom.controlPass,"pass-on")}else{if(this.prefs.markNext||this.variations.length>1){var d=this.sgfCoordToPoint(this.variations[a].move);if(this.board.getMarker(d)!=this.board.EMPTY){var e=this.board.getMarker(d);if(e.indexOf("var:")!==0){b=e}else{c=true}}if(this.prefs.markVariations&&!c){this.board.addMarker(d,"var:"+b)}}}var f=document.createElement("div");f.className="variation-nav";f.innerHTML=b;_4(f,"click",function(a,b){b.me.variation(b.varNum)},{me:this,varNum:this.variations[a].varNum});this.dom.variations.appendChild(f)}if(this.variations.length<2){this.dom.variations.innerHTML="<div class='variation-nav none'>"+t["no variations"]+"</div>"}if(this.cursor.hasNext()){_8(this.dom.controlForward,"forward-on");_8(this.dom.controlLast,"last-on")}else{_9(this.dom.controlForward,"forward-on");_9(this.dom.controlLast,"last-on")}if(this.cursor.hasPrevious()){_8(this.dom.controlBack,"back-on");_8(this.dom.controlFirst,"first-on")}else{_9(this.dom.controlBack,"back-on");_9(this.dom.controlFirst,"first-on");var g="";if(!this.prefs.showPlayerInfo){g+=this.getGameDescription(true)}if(!this.prefs.showGameInfo){g+=this.dom.infoGame.innerHTML}if(g.length&&this.theme!="problem"){this.prependComment(g,"comment-info")}}if(!this.progressiveLoad){this.updateNavSlider()}if(this.prefs.showNavTree){this.updateNavTree()}var h=this.cursor.node,i,j,k;if(h._parent&&!h._parent._parent&&h._parent._children.length>1){i=h.getPosition();j=t["multi-game sgf"];k="javascript:kingo.delegate("+this.uniq+', "goTo", [';if(i){j+="<a href='"+k+(i-1)+",0])'>"+t["previous game"]+"</a>"}if(h._parent._children[i+1]){j+=(i?" | ":"")+"<a href='"+k+(i+1)+",0])'>"+t["next game"]+"</a>"}this.prependComment(j,"comment-info")}},setColor:function(a){this.prependComment(a=="B"?t["black to play"]:t["white to play"]);this.currentColor=this.problemColor=a},setMoveNumber:function(a){this.moveNumber=a},playMove:function(a,b,c){b=b||this.currentColor;this.currentColor=b=="B"?"W":"B";b=b=="W"?this.board.WHITE:this.board.BLACK;var d=this.sgfCoordToPoint(a);if((!a||a=="tt"||a=="")&&!c){this.prependComment((b==this.board.WHITE?t["white"]:t["black"])+" "+t["passed"],"comment-pass")}else{if(a=="resign"){this.prependComment((b==this.board.WHITE?t["white"]:t["black"])+" "+t["resigned"],"comment-resign")}else{if(a&&a!="tt"){this.board.addStone(d,b);this.rules.apply(d,b);if(this.prefs.markCurrent&&!c){this.addMarker(a,"current")}}}}},addStone:function(a,b){if(!(a instanceof Array)){a=[a]}a=this.expandCompressedPoints(a);for(var c=0;c<a.length;c++){this.board.addStone(this.sgfCoordToPoint(a[c]),b=="AW"?this.board.WHITE:b=="AB"?this.board.BLACK:this.board.EMPTY)}},addMarker:function(a,b){if(!(a instanceof Array)){a=[a]}a=this.expandCompressedPoints(a);var c;for(var d=0;d<a.length;d++){switch(b){case"TR":c="triangle";break;case"SQ":c="square";break;case"CR":c="circle";break;case"MA":c="ex";break;case"TW":c="territory-white";break;case"TB":c="territory-black";break;case"DD":c="dim";break;case"LB":c=a[d].split(":")[1];break;default:c=b;break}this.board.addMarker(this.sgfCoordToPoint(a[d].split(":")[0]),c)}},showTime:function(a,b){var c=b=="BL"||b=="OB"?"timeB":"timeW";if(b=="BL"||b=="WL"){var d=Math.floor(a/60);var e=(a%60).toFixed(0);e=(e<10?"0":"")+e;this[c]=d+":"+e}else{this[c]+=" ("+a+")"}},showAnnotation:function(a,b){var c;switch(b){case"N":c=a;break;case"GB":c=a>1?t["vgb"]:t["gb"];break;case"GW":c=a>1?t["vgw"]:t["gw"];break;case"DM":c=a>1?t["dmj"]:t["dm"];break;case"UC":c=t["uc"];break;case"TE":c=t["te"];break;case"BM":c=a>1?t["vbm"]:t["bm"];break;case"DO":c=t["do"];break;case"IT":c=t["it"];break;case"HO":c=t["ho"];break}this.prependComment(c)},showComments:function(a,b,c){if(!a||c){return}this.dom.comments.innerHTML+=a.replace(/^(\n|\r|\t|\s)+/,"").replace(/\n/g,"<br />")},prependComment:function(a,b){b=b||"comment-status";this.dom.comments.innerHTML="<div class='"+b+"'>"+a+"</div>"+this.dom.comments.innerHTML},downloadSgf:function(a){_7(a);if(this.downloadUrl){if(this.unsavedChanges){alert(t["unsaved changes"]);return}location.href=this.downloadUrl+this.gameName}else{if(_c){location.href="data:text/plain,"+encodeURIComponent(this.cursor.getGameRoot().toSgf())}}},save:function(a){_7(a);var b=function(a){this.hook("saved",[a.responseText])};var c=function(a){this.croak(t["error retrieving"])};var d=this.cursor.getGameRoot().toSgf();_3("POST",this.saveUrl,{sgf:d},b,c,this,3e4)},constructDom:function(){this.dom.player=document.createElement("div");this.dom.player.className="kingo-player"+(this.theme?" theme-"+this.theme:"");this.dom.player.id="player-"+this.uniq;this.dom.container.innerHTML="";kingo.util.show(this.dom.container);this.dom.container.appendChild(this.dom.player);var a="            <div id='board-container' class='board-container'></div>            <div id='controls-container' class='controls-container'>                <ul id='controls' class='controls'>                    <li id='control-first' class='control first'>First</li>                    <li id='control-back' class='control back'>Back</li>                    <li id='control-forward' class='control forward'>Forward</li>                    <li id='control-last' class='control last'>Last</li>                    <li id='control-pass' class='control pass'>Pass</li>                </ul>                <div id='move-number' class='move-number"+(this.permalinkable?" permalink":"")+"'></div>                <div id='nav-slider' class='nav-slider'>                    <div id='nav-slider-thumb' class='nav-slider-thumb'></div>                </div>                <div id='variations-container' class='variations-container'>                    <div id='variations-label' class='variations-label'>"+t["variations"]+":</div>                    <div id='variations' class='variations'></div>                </div>                <div class='controls-stop'></div>            </div>            <div id='comments' class='comments'></div>            <div id='comments-edit' class='comments-edit'>                <textarea id='comments-edit-ta' class='comments-edit-ta'></textarea>                <div id='comments-edit-done' class='comments-edit-done'>"+t["done"]+"</div>            </div>            <div id='nav-tree-container' class='nav-tree-container'>                <div id='nav-tree' class='nav-tree'></div>            </div>            <div id='tools-container' class='tools-container'"+(this.prefs.showTools?"":" style='display: none'")+">                <div id='tools-label' class='tools-label'>"+t["tool"]+":</div>                <select id='tools-select' class='tools-select'>                    <option value='play'>&#9658; "+t["play"]+"</option>                    <option value='view'>&#8594; "+t["view"]+"</option>                    <option value='add_b'>&#9679; "+t["add_b"]+"</option>                    <option value='add_w'>&#9675; "+t["add_w"]+"</option>                    "+(this.searchUrl?"<option value='region'>&#9618; "+t["region"]+"</option>":"")+"                    "+(this.saveUrl&&!this.progressiveLoad?"<option value='comment'> "+t["edit comment"]+"</option>":"")+"                    "+(this.saveUrl?"<option value='gameinfo'>&#8962; "+t["edit game info"]+"</option>":"")+"                    <option value='tr'>&#9650; "+t["triangle"]+"</option>                    <option value='sq'>&#9632; "+t["square"]+"</option>                    <option value='cr'>&#9679; "+t["circle"]+"</option>                    <option value='x'> "+t["x"]+"</option>                    <option value='letter'>A "+t["letter"]+"</option>                    <option value='number'>5 "+t["number"]+"</option>                    <option value='label'> "+t["label"]+"</option>                    <option value='dim'>&#9619; "+t["dim"]+"</option>                    <option value='clear'>&#9617; "+t["clear"]+"</option>                </select>                <input type='button' id='score-est' class='score-est-button' value='"+t["score est"]+"' />                <select id='search-algo' class='search-algo'>                    <option value='corner'>"+t["search corner"]+"</option>                    <option value='center'>"+t["search center"]+"</option>                </select>                <input type='button' id='search-button' class='search-button' value='"+t["search"]+"' />                <input type='text' id='label-input' class='label-input' />            </div>            <div id='game-info-edit' class='game-info-edit'>                <div id='game-info-edit-form' class='game-info-edit-form'></div>                <div id='game-info-edit-done' class='game-info-edit-done'>"+t["done"]+"</div>            </div>            <div id='search-container' class='search-container'>                <div id='search-close' class='search-close'>"+t["close search"]+"</div>                <p class='search-count'><span id='search-count'></span> "+t["matches found"]+"                    Showing <span id='search-offset-start'></span>-<span id='search-offset-end'></span></p>                <div id='search-results-container' class='search-results-container'>                    <div class='search-result'>                        <span class='pw'><b>"+t["white"]+"</b></span>                        <span class='pb'><b>"+t["black"]+"</b></span>                        <span class='re'><b>"+t["result"]+"</b></span>                        <span class='dt'><b>"+t["date"]+"</b></span>                        <div class='clear'></div>                    </div>                    <div id='search-results' class='search-results'></div>                </div>            </div>            <div id='info' class='info'>                <div id='info-players' class='players'>                    <div id='white' class='player white'>                        <div id='white-name' class='name'></div>                        <div id='white-captures' class='captures'></div>                        <div id='white-time' class='time'></div>                    </div>                    <div id='black' class='player black'>                        <div id='black-name' class='name'></div>                        <div id='black-captures' class='captures'></div>                        <div id='black-time' class='time'></div>                    </div>                </div>                <div id='info-game' class='game'></div>            </div>            <div id='options' class='options'>                "+(this.saveUrl?"<a id='option-save' class='option-save' href='#'>"+t["save to server"]+"</a>":"")+"                "+(this.downloadUrl||_c?"<a id='option-download' class='option-download' href='#'>"+t["download sgf"]+"</a>":"")+"                <div class='options-stop'></div>            </div>            <div id='preferences' class='preferences'>                <div><input type='checkbox'> Show variations on board</div>                <div><input type='checkbox'> Mark current move</div>            </div>            <div id='footer' class='footer'></div>            <div id='shade' class='shade'></div>        ";a=a.replace(/ id='([^']+)'/g," id='$1-"+this.uniq+"'");this.dom.player.innerHTML=a;var b=/ id='([^']+)-\d+'/g;var c;var d;var e;while(c=b.exec(a)){d=c[0].replace(/'/g,"").replace(/ id=/,"");e="";c[1].split("-").forEach(function(a,b){a=b?a.charAt(0).toUpperCase()+a.substring(1):a;e+=a});this.dom[e]=_2(d)}[["moveNumber","setPermalink"],["controlFirst","first"],["controlBack","back"],["controlForward","forward"],["controlLast","last"],["controlPass","pass"],["scoreEst","fetchScoreEstimate"],["searchButton","searchRegion"],["searchResults","loadSearchResult"],["searchClose","closeSearch"],["optionDownload","downloadSgf"],["optionSave","save"],["commentsEditDone","finishEditComment"],["gameInfoEditDone","finishEditGameInfo"],["navTree","navTreeClick"]].forEach(function(a){if(this.dom[a[0]]){_5(this.dom[a[0]],this[a[1]],this)}}.bind(this));_4(this.dom.toolsSelect,"change",function(a){this.selectTool.apply(this,[(a.target||a.srcElement).value])},this,true)},enableNavSlider:function(){if(this.progressiveLoad){_b(this.dom.navSliderThumb);return}this.dom.navSlider.style.cursor="pointer";var a=false;var b=null;_4(this.dom.navSlider,"mousedown",function(b){a=true;_7(b)},this,true);_4(document,"mousemove",function(c){if(!a){return}var d=_6(c,this.dom.navSlider);clearTimeout(b);b=setTimeout(function(){this.updateNavSlider(d[0])}.bind(this),10);_7(c)},this,true);_4(document,"mouseup",function(b){if(!a){return true}a=false;var c=_6(b,this.dom.navSlider);this.updateNavSlider(c[0]);return true},this,true)},updateNavSlider:function(a){var b=this.dom.navSlider.offsetWidth-this.dom.navSliderThumb.offsetHeight;var c=this.totalMoves;var d=!!a;a=a||this.moveNumber/c*b;a=a>b?b:a;a=a<0?0:a;var e=parseInt(a/b*c,10);if(d){this.nowLoading();var f=e-this.cursor.getMoveNumber();for(var g=0;g<Math.abs(f);g++){if(f>0){this.variation(null,true)}else{if(f<0){this.cursor.previous()}}}if(f<0){this.board.revert(Math.abs(f))}this.doneLoading();this.refresh()}a=parseInt(e/c*b,10)||0;this.dom.navSliderThumb.style.left=a+"px"},updateNavTree:function(a){if(!this.prefs.showNavTree){return}if(this.updatedNavTree){this.showNavTreeCurrent();return}if(!a){if(this.navTreeTimeout){clearTimeout(this.navTreeTimeout)}this.navTreeTimeout=setTimeout(function(){this.updateNavTree(true)}.bind(this),kingo.browser.ie?1e3:500);return}this.updatedNavTree=true;var b=[],c=this.cursor.getGameRoot();path=[c.getPosition()],h=new kingo.GameCursor,maxx=0;var d=function(a,c,e){var f=e,g=c;var i=a,j=1;while(i&&i._children.length==1){j++;i=i._children[0]}while(b[f]&&b[f].slice(g,g+j+1).some(function(a){return typeof a!="undefined"})){f++}do{if(!b[f]){b[f]=[]}h.node=a;a._pathStr=path.join("-")+"-"+(g-c);b[f][g]=a;if(g>maxx){maxx=g}g++;if(a._children.length!=1){break}a=a._children[0]}while(a);for(var k=0;k<a._children.length;k++){path.push(k);d(a._children[k],g,f);path.pop()}};d(c,0,0);var e=["<table class='nav-tree'>"],f,g,h=new kingo.GameCursor,i,j,k,l=1,m=2;for(i=0;i<maxx;i++){k=false;for(j=b.length-1;j>0;j--){if(!b[j][i]){if(typeof b[j][i+1]=="object"){b[j][i]=l;k=true}else{if(k){b[j][i]=m}}}else{k=false}}}for(j=0;j<b.length;j++){e.push("<tr>");for(i=0;i<b[j].length;i++){f=b[j][i];if(f==l){g="<div class='elbow'></div>"}else{if(f==m){g="<div class='line'></div>"}else{if(f){g=["<a href='#' id='navtree-node-",f._pathStr,"' class='",typeof f.W!="undefined"?"w":typeof f.B!="undefined"?"b":"x","'>",i,"</a>"].join("")}else{g="<div class='empty'></div>"}}}e.push("<td>");e.push(g);e.push("</td>")}e.push("</tr>")}e.push("</table>");this.dom.navTree.innerHTML=e.join("");setTimeout(function(){this.showNavTreeCurrent()}.bind(this),0)},showNavTreeCurrent:function(){var a="navtree-node-"+this.cursor.getPath().join("-"),b=_2(a);if(!b){return}if(this.prevNavTreeCurrent){this.prevNavTreeCurrent.className=this.prevNavTreeCurrentClass}this.prevNavTreeCurrent=b;this.prevNavTreeCurrentClass=b.className;b.className="current";var c=b.offsetWidth,d=b.offsetHeight,e=kingo.util.getElXY(b),f=kingo.util.getElXY(this.dom.navTree),g=e[0]-f[0],h=e[1]-f[1],i=this.dom.navTreeContainer,j=i.scrollLeft,k=j+i.offsetWidth-100;maxt=i.scrollTop,maxb=maxt+i.offsetHeight-30;if(g<j){i.scrollLeft-=j-g}if(g+c>k){i.scrollLeft+=g+c-k}if(h<maxt){i.scrollTop-=maxt-h}if(h+d>maxb){i.scrollTop+=h+d-maxb}},navTreeClick:function(a){var b=a.target||a.srcElement;if(!b||!b.id){return}var c=b.id.replace(/^navtree-node-/,"").split("-");this.goTo(c,true);_7(a)},resetLastLabels:function(){this.labelLastNumber=1;this.labelLastLetter="A"},getGameDescription:function(a){var b=this.cursor.getGameRoot();if(!b){return}var c=a?"":b.GN||this.gameName;if(b.PW&&b.PB){var d=b.WR?" "+b.WR:"";var e=b.BR?" "+b.BR:"";c+=(c.length?" - ":"")+b.PW+d+" vs "+b.PB+e}return c},sgfCoordToPoint:function(a){if(!a||a=="tt"){return{x:null,y:null}}var b={a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7,i:8,j:9,k:10,l:11,m:12,n:13,o:14,p:15,q:16,r:17,s:18};return{x:b[a.charAt(0)],y:b[a.charAt(1)]}},pointToSgfCoord:function(a){if(!a||this.board&&!this.boundsCheck(a.x,a.y,[0,this.board.boardSize-1])){return null}var b={0:"a",1:"b",2:"c",3:"d",4:"e",5:"f",6:"g",7:"h",8:"i",9:"j",10:"k",11:"l",12:"m",13:"n",14:"o",15:"p",16:"q",17:"r",18:"s"};return b[a.x]+b[a.y]},expandCompressedPoints:function(a){var b;var c,d;var e,f;var g=[];var h=[];for(var i=0;i<a.length;i++){b=a[i].split(/:/);if(b.length>1){c=this.sgfCoordToPoint(b[0]);d=this.sgfCoordToPoint(b[1]);for(e=c.x;e<=d.x;e++){for(f=c.y;f<=d.y;f++){g.push(this.pointToSgfCoord({x:e,y:f}))}}h.push(i)}}a=a.concat(g);return a},setPermalink:function(){if(!this.permalinkable){return true}if(this.unsavedChanges){alert(t["unsaved changes"]);return}this.hook("setPermalink")},nowLoading:function(a){if(this.croaked||this.problemMode){return}a=a||t["loading"]+"...";if(_2("kingo-loading-"+this.uniq)){return}this.domLoading=document.createElement("div");this.domLoading.id="kingo-loading-"+this.uniq;this.domLoading.className="kingo-loading"+(this.theme?" theme-"+this.theme:"");this.domLoading.innerHTML=a;this.dom.player.appendChild(this.domLoading)},doneLoading:function(){if(this.domLoading&&this.domLoading!=null&&this.domLoading.parentNode){this.domLoading.parentNode.removeChild(this.domLoading);this.domLoading=null}},croak:function(a){this.doneLoading();if(this.board){alert(a)}else{if(this.problemMode){this.prependComment(a)}else{this.dom.player.innerHTML+="<div class='kingo-error "+(this.theme?" theme-"+this.theme:"")+"'>"+a.replace(/\n/g,"<br />")+"</div>";this.croaked=true}}},toggleBoard:function(){(this.prefs.showBoard?_a:_b)(this.dom.boardContainer);this.prefs.showBoard=!this.prefs.showBoard},toggleControls:function(){(this.prefs.showControls?_a:_b)(this.dom.controlsContainer);this.prefs.showControls=!this.prefs.showControls},toggleTools:function(){(this.prefs.showTools?_b:_a)(this.dom.toolsContainer);this.prefs.showTools=!this.prefs.showTools},toggleComments:function(){(this.prefs.showComments?_b:_a)(this.dom.comments);this.prefs.showComments=!this.prefs.showComments},toggleInfo:function(){(this.prefs.showInfo?_a:_b)(this.dom.info);this.prefs.showInfo=!this.prefs.showInfo},toggleNavTree:function(){(this.prefs.showNavTree?_b:_a)(this.dom.navTreeContainer);this.prefs.showNavTree=!this.prefs.showNavTree},toggleOptions:function(){(this.prefs.showOptions?_b:_a)(this.dom.options);this.prefs.showOptions=!this.prefs.showOptions}}})();(function(){var a=window.kingoConfig||{};var b={theme:"problem",problemMode:true,markVariations:false,markNext:false,shrinkToFit:true};var c=kingo.util.getPlayerPath();var d=kingo.playerPath=(a.playerPath||c||"player").replace(/\/$/,"");if(!a.skipCss){kingo.util.addStyleSheet(d+"/player.css");if(kingo.browser.ie&&parseInt(kingo.browser.ver,10)<=6){kingo.util.addStyleSheet(d+"/player-ie6.css")}}kingo.util.addEvent(window,"load",function(){kingo.autoPlayers=[];var c=[];var d=document.getElementsByTagName("div");var e=d.length;for(var f=0;f<e;f++){if(kingo.util.hasClass(d[f],"kingo-player-auto")||kingo.util.hasClass(d[f],"kingo-player-problem")){c.push(d[f])}}var g;for(var f=0;g=c[f];f++){var h={container:g,enableShortcuts:false,theme:"compact"};if(kingo.util.hasClass(g,"kingo-player-problem")){for(var i in b){h[i]=b[i]}}for(var i in a){h[i]=a[i]}var j=g.getAttribute("sgf");if(j){h.sgfUrl=j}else{if(g.innerHTML){h.sgf=g.innerHTML}}var k=g.getAttribute("shrink");if(k){h.shrinkToFit=k=="no"?false:true}g.innerHTML="";kingo.util.show(g);var l=new kingo.Player(h);kingo.autoPlayers.push(l)}})})()
